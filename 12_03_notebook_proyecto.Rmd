---
title: "Nociones básicas de estadística descriptiva y visualización"
author: "Ariel Salgado"
date: "20 de Julio de 2021"
output:
  html_document:
    df_print: paged
    toc: yes
  html_notebook:
    theme: lumen
    toc: yes
    toc_float: yes
  word_document:
    toc: yes
  pdf_document:
    toc: yes
subtitle: Laboratorio de Datos
---

# Importacion de librerias y datos ---------------------------------------------
```{r}
library(ggplot2)
library(grid)
library(gridExtra)
library(reshape)
library(ggridges)
library(dplyr)
library(gganimate)
library(tidyverse)
library(class)
library(caret)

datos <- read.csv("exp_de_vida.csv")
head(datos)

colores_continente <- c("firebrick","deepskyblue3","goldenrod1",
                        "limegreen","black")
names(colores_continente) <- c("America","Europa","Asia",
                               "Oceania","Africa")
                                   
colores_desarrollo <- c("firebrick","deepskyblue3")
names(colores_desarrollo) <- c("Developing","Developed")
```

Renombramos las columnas para que mantengan cierta estructura y limpiamos algunas que contienen datos imposibles o altamente sospechosos

```{r}
# limpieza de columnas ---------------------------------------------------------

datos <- datos %>% 
  select(-c(BMI, percentage.expenditure, GDP, Population)) %>% 
  dplyr::rename("pais" = "Country",
         "region" = "Region",
         "ano" = "Year",
         "nivel" = "Status",
         "exp_de_vida" = "Life.expectancy",
         "mortalidad_adultos" = "Adult.Mortality",
         "muertes_infantes" = "infant.deaths",
         "alcohol" = "Alcohol",
         "hepatitis_b" = "Hepatitis.B",
         "sarampion" = "Measles",
         "muertes_menores_5" = "under.five.deaths",
         "polio" = "Polio",
         "gasto_total" = "Total.expenditure",
         "difteria" = "Diphtheria",
         "vih_sida" = "HIV.AIDS",
         "delgadez_10_a_19" = "thinness..1.19.years",
         "delgadez_5_a_9" = "thinness.5.9.years",
         "indice_icr" = "Income.composition.of.resources",
         "escolaridad" = "Schooling")

datos$muertes_infantes[datos$muertes_infantes > 800] <- NA
datos$sarampion[datos$sarampion > 900] <- NA
datos$muertes_menores_5[datos$muertes_menores_5 > 700] <- NA
datos$indice_icr[datos$indice_icr == 0] <- NA
datos$escolaridad[datos$indice_icr == 0] <- NA


datos$region <- as.character(datos$region)
datos$region[datos$region == "America del Sur"] <- "America"
datos$region[datos$region == "America del Norte"] <- "America"
datos$region[datos$region == "America Central"] <- "America"


datos$pais <- as.character(datos$pais)
datos$pais[datos$pais == "Bolivia (Plurinational State of)"] <- "Bolivia"
datos$pais[datos$pais == "Venezuela (Bolivarian Republic of)"] <- "Venezuela"
datos$pais[datos$pais == "United Kingdom of Great Britain and Northern Ireland"] <- "UK"
datos$pais[datos$pais == "United Republic of Tanzania"] <- "Tanzania"
datos$pais[datos$pais == "United States of America"] <- "USA"
datos$pais[datos$pais == "Iran (Islamic Republic of)"] <- "Iran"
datos$pais[datos$pais == "Russian Federation"] <- "Russia"
datos$pais[datos$pais == "Viet Nam"] <- "Vietnam"
datos$pais[datos$pais == "Côte d'Ivoire"] <- "Ivory Coast"
datos$pais[datos$pais == "Congo"] <- "Republic of Congo"
datos$pais[datos$pais == "Brunei Darussalam"] <- "Brunei"

```


```{r}
# agregamos datos del GDP ------------------------------------------------------

library(tidyr)

gdp <- read.csv("gdp.csv")
gdp <- gdp[, c(1,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28)]

gdp <- gather(gdp, key = "ano", value = "Value", "X2000","X2001","X2002","X2003","X2004","X2005","X2006","X2007","X2008","X2009","X2010","X2011","X2012","X2013","X2014","X2015")
gdp$ano[gdp$ano == "X2000"] <- "2000"
gdp$ano[gdp$ano == "X2001"] <- "2001"
gdp$ano[gdp$ano == "X2002"] <- "2002"
gdp$ano[gdp$ano == "X2003"] <- "2003"
gdp$ano[gdp$ano == "X2004"] <- "2004"
gdp$ano[gdp$ano == "X2005"] <- "2005"
gdp$ano[gdp$ano == "X2006"] <- "2006"
gdp$ano[gdp$ano == "X2007"] <- "2007"
gdp$ano[gdp$ano == "X2008"] <- "2008"
gdp$ano[gdp$ano == "X2009"] <- "2009"
gdp$ano[gdp$ano == "X2010"] <- "2010"
gdp$ano[gdp$ano == "X2011"] <- "2011"
gdp$ano[gdp$ano == "X2012"] <- "2012"
gdp$ano[gdp$ano == "X2013"] <- "2013"
gdp$ano[gdp$ano == "X2014"] <- "2014"
gdp$ano[gdp$ano == "X2015"] <- "2015"

gdp$ano <- as.integer(gdp$ano)
colnames(gdp) <- c("pais","ano","gdp")

gdp$pais[gdp$pais == "United States"] <- "USA"
gdp$pais[gdp$pais == "Bahamas"] <- "Bahamas"
gdp$pais[gdp$pais == "Congo, Dem. Rep."] <- "Democratic Republic of the Congo"
gdp$pais[gdp$pais == "Congo, Rep."] <- "Republic of Congo"
gdp$pais[gdp$pais == "United Kingdom"] <- "UK"
gdp$pais[gdp$pais == "Egypt, Arab Rep."] <- "Egypt"
gdp$pais[gdp$pais == "	Gambia, The"] <- "Gambia"

datos <- left_join(datos, gdp, by=c('pais'='pais', 'ano'='ano'))
```

Veamos la distribucion de la variable estrella de nuestro proyecto: expectativa de vida

```{r}
# distribucion de exp. de vida por region -------------------------------------- 

datos_2000 <- datos[is.element(datos$ano,"2000"),]
datos_2005 <- datos[is.element(datos$ano,"2005"),]
datos_2010 <- datos[is.element(datos$ano,"2010"),]
datos_2015 <- datos[is.element(datos$ano,"2015"),]

g2000 <- ggplot(datos_2000, aes(x = exp_de_vida, y = region, fill = region)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2000")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_continente)

g2005 <- ggplot(datos_2005, aes(x = exp_de_vida, y = region, fill = region)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2005")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_continente)

g2010 <- ggplot(datos_2010, aes(x = exp_de_vida, y = region, fill = region)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2010")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_continente)

g2015 <- ggplot(datos_2015, aes(x = exp_de_vida, y = region, fill = region)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2015")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_continente)

print(grid.arrange(g2000,g2005,g2010,g2015, nrow = 2, ncol = 2))

```


```{r}
# distribucion de exp. de vida por nivel de desarrollo-------------------------- MOSTRABLE


n2000 <- ggplot(datos_2000, aes(x = exp_de_vida, y = nivel, fill = nivel)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2000")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_desarrollo)

n2005 <- ggplot(datos_2005, aes(x = exp_de_vida, y = nivel, fill = nivel)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2005")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_desarrollo)

n2010 <- ggplot(datos_2010, aes(x = exp_de_vida, y = nivel, fill = nivel)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2010")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_desarrollo)

n2015 <- ggplot(datos_2015, aes(x = exp_de_vida, y = nivel, fill = nivel)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2015")+
  xlim(30,100)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_desarrollo)

print(grid.arrange(n2000,n2005,n2010,n2015, nrow = 2, ncol = 2))
```


```{r}
# distribucion de nivel de desarrollo por continente --------------------------- MOSTRABLE

r2000 <- ggplot(datos_2000, aes(x = region, fill = nivel)) +
  geom_bar(position="dodge")+
  ggtitle("2000")+
  ylim(0,55)+
  ylab("cantidad")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

r2005 <- ggplot(datos_2005, aes(x = region, fill = nivel)) +
  geom_bar(position="dodge")+
  ggtitle("2005")+
  ylim(0,55)+
  ylab("cantidad")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

r2010 <- ggplot(datos_2010, aes(x = region, fill = nivel)) +
  geom_bar(position="dodge")+
  ggtitle("2010")+
  ylim(0,55)+
  ylab("cantidad")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

r2015 <- ggplot(datos_2015, aes(x = region, fill = nivel)) +
  geom_bar(position="dodge")+
  ggtitle("2015")+
  ylim(0,55)+
  ylab("cantidad")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

print(grid.arrange(r2000,r2005,r2010,r2015, nrow = 2, ncol = 2))
```


```{r}
s2000 <- ggplot(datos_2000, aes(x = region, fill = nivel)) +
  geom_bar(position="fill")+
  ggtitle("2000")+
  ylab("proporcion")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

s2005 <- ggplot(datos_2005, aes(x = region, fill = nivel)) +
  geom_bar(position="fill")+
  ggtitle("2005")+
  ylab("proporcion")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

s2010 <- ggplot(datos_2010, aes(x = region, fill = nivel)) +
  geom_bar(position="fill")+
  ggtitle("2010")+
  ylab("proporcion")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

s2015 <- ggplot(datos_2015, aes(x = region, fill = nivel)) +
  geom_bar(position="fill")+
  ggtitle("2015")+
  ylab("proporcion")+
  xlab("region")+
  scale_fill_manual(values = colores_desarrollo)

grid.arrange(s2000,s2005,s2010,s2015, nrow = 2, ncol = 2)
```

Tambien veamoslo en los mapas

```{r, fig.dim = c(10,4)}
# mapas exp. de vida ----------------------------------------------------------- 


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2000, by="pais")
mapdata2000<-mapdata %>% filter(!is.na(mapdata$exp_de_vida))

mapa2000<-ggplot(mapdata2000, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2000")+
  scale_fill_gradient(name = "exp. de vida", low = "gold1", high =  "navyblue", limits = c(40,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- full_join(mapdata, datos_2005, by="pais")
mapdata2005<-mapdata %>% filter(!is.na(mapdata$exp_de_vida))

mapa2005<-ggplot(mapdata2005, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2005")+
  scale_fill_gradient(name = "exp. de vida", low = "gold1", high =  "navyblue", limits = c(40,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())

mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- full_join(mapdata, datos_2010, by="pais")
mapdata2010<-mapdata %>% filter(!is.na(mapdata$exp_de_vida))

mapa2010<-ggplot(mapdata2010, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2010")+
  scale_fill_gradient(name = "exp. de vida", low = "gold1", high =  "navyblue", limits = c(40,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())

mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- full_join(mapdata, datos_2015, by="pais")
mapdata2015<-mapdata %>% filter(!is.na(mapdata$exp_de_vida))

mapa2015<-ggplot(mapdata2015, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2015")+
  scale_fill_gradient(name = "exp. de vida", low = "gold1", high =  "navyblue", limits = c(40,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())

grid.arrange(mapa2000,mapa2005,mapa2010,mapa2015, nrow=2, ncol=2)

```


```{r, fig.dim = c(10,6)}

# EUROPA --------

mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2000, by="pais")
mapdata2000<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Europa"))

mapa2000<-ggplot(mapdata2000, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2000")+
  scale_fill_gradient(name = "exp. de vida", low = "cadetblue1", high =  "darkblue", limits = c(65,90), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2005, by="pais")
mapdata2005<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Europa"))

mapa2005<-ggplot(mapdata2005, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2005")+
  scale_fill_gradient(name = "exp. de vida", low = "cadetblue1", high =  "darkblue", limits = c(65,90), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2010, by="pais")
mapdata2010<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Europa"))

mapa2010<-ggplot(mapdata2010, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2010")+
  scale_fill_gradient(name = "exp. de vida", low = "cadetblue1", high =  "darkblue", limits = c(65,90), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())



mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2015, by="pais")
mapdata2015<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Europa") & !is.element(mapdata$pais, "Bahamas"))

mapa2015<-ggplot(mapdata2015, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2015")+
  scale_fill_gradient(name = "exp. de vida", low = "cadetblue1", high =  "darkblue", limits = c(65,90), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())

grid.arrange(mapa2000,mapa2005,mapa2010,mapa2015, nrow=2, ncol=2)

# AMERICA -------

mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2000, by="pais")
mapdata2000<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "America"))

mapa2000<-ggplot(mapdata2000, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2000")+
  scale_fill_gradient(name = "exp. de vida", low = "white", high =  "darkred", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2005, by="pais")
mapdata2005<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "America"))

mapa2005<-ggplot(mapdata2005, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2005")+
  scale_fill_gradient(name = "exp. de vida", low = "white", high =  "darkred", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2010, by="pais")
mapdata2010<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "America"))

mapa2010<-ggplot(mapdata2010, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2010")+
  scale_fill_gradient(name = "exp. de vida", low = "white", high =  "darkred", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())



mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2015, by="pais")
mapdata2015<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "America"))

mapa2015<-ggplot(mapdata2015, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2015")+
  scale_fill_gradient(name = "exp. de vida", low = "white", high =  "darkred", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())

grid.arrange(mapa2000,mapa2005,mapa2010,mapa2015, nrow=2, ncol=2)


# ASIA ----------

mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2000, by="pais")
mapdata2000<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Asia"))

mapa2000<-ggplot(mapdata2000, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2000")+
  scale_fill_gradient(name = "exp. de vida", low = "khaki1", high =  "saddlebrown", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2005, by="pais")
mapdata2005<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Asia"))

mapa2005<-ggplot(mapdata2005, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2005")+
  scale_fill_gradient(name = "exp. de vida", low = "khaki1", high =  "saddlebrown", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2010, by="pais")
mapdata2010<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Asia"))

mapa2010<-ggplot(mapdata2010, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2010")+
  scale_fill_gradient(name = "exp. de vida", low = "khaki1", high =  "saddlebrown", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())



mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2015, by="pais")
mapdata2015<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Asia"))

mapa2015<-ggplot(mapdata2015, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "grey10")+
  ggtitle("Exp. de vida en el 2015")+
  scale_fill_gradient(name = "exp. de vida", low = "khaki1", high =  "saddlebrown", limits = c(60,85), na.value = "grey")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())

grid.arrange(mapa2000,mapa2005,mapa2010,mapa2015, nrow=2, ncol=2)



# AFRICA ---------

mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2000, by="pais")
mapdata2000<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Africa"))

mapa2000<-ggplot(mapdata2000, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "white")+
  ggtitle("Exp. de vida en el 2000")+
  scale_fill_gradient(name = "exp. de vida", low = "gray80", high =  "black", limits = c(40,80), na.value = "lightyellow")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2005, by="pais")
mapdata2005<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Africa"))

mapa2005<-ggplot(mapdata2005, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "white")+
  ggtitle("Exp. de vida en el 2005")+
  scale_fill_gradient(name = "exp. de vida", low = "gray80", high =  "black", limits = c(40,80), na.value = "lightyellow")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())


mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2010, by="pais")
mapdata2010<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Africa"))

mapa2010<-ggplot(mapdata2010, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "white")+
  ggtitle("Exp. de vida en el 2010")+
  scale_fill_gradient(name = "exp. de vida", low = "gray80", high =  "black", limits = c(40,80), na.value = "lightyellow")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())



mapdata <- map_data("world") ##ggplot2
colnames(mapdata)[5] <- "pais"
mapdata <- left_join(mapdata, datos_2015, by="pais")
mapdata2015<-mapdata %>% filter(!is.na(mapdata$exp_de_vida) & is.element(mapdata$region, "Africa"))

mapa2015<-ggplot(mapdata2015, aes( x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = exp_de_vida), color = "white")+
  ggtitle("Exp. de vida en el 2015")+
  scale_fill_gradient(name = "exp. de vida", low = "gray80", high =  "black", limits = c(40,80), na.value = "lightyellow")+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())

grid.arrange(mapa2000,mapa2005,mapa2010,mapa2015, nrow=2, ncol=2)

```

Expectativa de vida vs ICR por año, grafico en movimiento

```{r}
library(plotly)

r3 <- plot_ly(datos, x = ~`indice_icr`, y = ~`exp_de_vida`, 
          frame=~ano,size= ~`gdp`,color=~`region`,colors=colores_continente,mode="markers",marker = list(symbol = 'circle', sizemode = 'diameter',
          line = list(width = 2, color = '#FFFFFF'), opacity=0.75)) %>% animation_opts(1000, redraw = FALSE)

r3
```





```{r}
# mini analisis de Europa ------------------------------------------------------ MOSTRABLE

europa <- datos[datos$region == "Europa" & !is.element(datos$escolaridad,0),]

balcanes <- c("Bosnia and Herzegovina", "Croatia","Montenegro", 
              "Serbia", "Slovenia", "Macedonia")
europa$guerra_yugoslava <- "no"
europa$guerra_yugoslava[europa$pais %in% balcanes] <- "si"


colores_guerra_yugoslava <- c("firebrick", "deepskyblue3")
names(colores_guerra_yugoslava) <- c('si', 'no')

ggplot(europa,aes(escolaridad,exp_de_vida,color = guerra_yugoslava))+
  geom_point()+
  scale_color_manual(values = colores_guerra_yugoslava)

ggplot(europa, aes(guerra_yugoslava,exp_de_vida,fill = guerra_yugoslava))+
  geom_boxplot()


e2000 <- ggplot(europa[europa$ano == 2000,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2000")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2001 <- ggplot(europa[europa$ano == 2001,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2001")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2002 <- ggplot(europa[europa$ano == 2002,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2002")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2003 <- ggplot(europa[europa$ano == 2003,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2003")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2004 <- ggplot(europa[europa$ano == 2004,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2004")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2005 <- ggplot(europa[europa$ano == 2005,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2005")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2006 <- ggplot(europa[europa$ano == 2006,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2006")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2007 <- ggplot(europa[europa$ano == 2007,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2007")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)

e2008 <- ggplot(europa[europa$ano == 2008,], aes(x = exp_de_vida, y = guerra_yugoslava, fill = guerra_yugoslava)) +
  geom_density_ridges() +
  theme_ridges() + 
  theme(legend.position = "none") +
  ggtitle("2008")+
  xlim(65,90)+
  ylab("")+
  xlab("exp. de vida")+
  scale_fill_manual(values = colores_guerra_yugoslava)


print(grid.arrange(e2000,e2001,e2002,e2003,e2004,e2005,e2006,e2007,e2008, nrow = 3, ncol = 3))
```


```{r}
# distribucion de delgadez, año 2013 -------------------------------------------

datos_2013 <- datos[is.element(datos$ano, "2013"),]


ggplot(datos_2013, aes(x = region, y = delgadez_10_a_19)) +
  geom_violin(aes(fill=region)) +
  ylab("Delgadez 5 a 9")+
  xlab("Region")+
  scale_fill_manual(values = colores_continente)

ggplot(datos, aes(region,indice_icr)) + 
  geom_violin(aes(fill=region))+
  scale_fill_manual(values = colores_continente)


                  # asia es el mas distribuido

```


```{r}
# evolucion de exp. de vida promedio por continente y año ----------------------

datos_exp <- datos[!is.na(datos$exp_de_vida),]
promedios_exp <- datos_exp%>% group_by(region,ano)%>%summarise(mean_val=mean(exp_de_vida))

ggplot(promedios_exp, aes(ano,mean_val,color=region))+
  geom_line(size=1)+
  xlab("Año")+
  ylab("Promedio de exp. de vida")+
  scale_color_manual(values = colores_continente)
```

En america hay un valle muy particular en el año 2010. ¿Hay algunos paises cuya exp. de vida haya disminuido drasticamente? ¿Habra habido alguna catastrofe en ese año?

```{r, fig.dim = c(2,1.5)}
america <- datos[is.element(datos$region, "America"),]
paises_america <- unique(america$pais)

for(i in paises_america){
  data <- america[america$pais== i,]
  print(ggplot(data, aes(ano,exp_de_vida))+
    geom_line(size=1)+
    xlab("Año")+
    ylab("Promedio de exp. de vida")+
    ggtitle(i)+
    geom_vline(xintercept = 2010)
  )
  
}
```

Si vemos el grafico de Haiti podremos notar una caida abismal en la exp. de vida, y no es coincidencia que en dicho año haya habido un terremoto en la isla. Esto nos muestra que hay variables no incluidas en el dataset que claramente afectan al nivel de exp. de vida de un pais, por ejemplo catastrofes naturales. De ahora en mas, cada cambio repentino hay que agarrarlo con pinzas...



```{r}
g16 <- ggplot(datos,aes(muertes_infantes,difteria,color=region))+
          geom_point()+
          ggtitle("Difteria")+
          xlim(0,600)+
          scale_color_manual(values = colores_continente)
g16

g17 <- ggplot(datos,aes(muertes_infantes,polio,color=region))+
        geom_point()+
        ggtitle("Polio")+
        xlim(0,600)+
        scale_color_manual(values = colores_continente)
g17

g18 <- ggplot(datos,aes(muertes_infantes,hepatitis_b,color=region))+
        geom_point()+
        ggtitle("Hepatitis B")+
        xlim(0,600)+
        scale_color_manual(values = colores_continente)
g18
```

Hacemos un KNN para developed vs developing

```{r}

y2000<-ggplot(datos_2000, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2000")+
  xlim(35,90)+
  scale_color_manual(values = colores_desarrollo)

y2005<-ggplot(datos_2005, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2005")+
  xlim(35,90)+
  scale_color_manual(values = colores_desarrollo)

y2010<-ggplot(datos_2010, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2010")+
  xlim(35,90)+
  scale_color_manual(values = colores_desarrollo)

y2015<-ggplot(datos_2015, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2015")+
  xlim(35,90)+
  scale_color_manual(values = colores_desarrollo)

grid.arrange(y2000,y2005,y2010,y2015, ncol=2, nrow=2)



datos_knn <- datos[!is.na(datos$exp_de_vida) & !is.na(datos$gdp), c(3,4,5,20)]

datos_knn["exp_de_vida"] <- (datos_knn$exp_de_vida - mean(datos_knn$exp_de_vida))/ sd(datos_knn$exp_de_vida)
datos_knn["gdp"] <- (datos_knn$gdp - mean(datos_knn$gdp))/ sd(datos_knn$gdp)


datos_knn_2000 <- datos_knn[is.element(datos_knn$ano,"2000"),]
datos_knn_2005 <- datos_knn[is.element(datos_knn$ano,"2005"),]
datos_knn_2010 <- datos_knn[is.element(datos_knn$ano,"2010"),]
datos_knn_2015 <- datos_knn[is.element(datos_knn$ano,"2015"),]


z2000<-ggplot(datos_knn_2000, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2000")+
  scale_color_manual(values = colores_desarrollo)

z2005<-ggplot(datos_knn_2005, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2005")+
  scale_color_manual(values = colores_desarrollo)

z2010<-ggplot(datos_knn_2010, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2010")+
  scale_color_manual(values = colores_desarrollo)

z2015<-ggplot(datos_knn_2015, aes(exp_de_vida, gdp, color=nivel))+
  geom_point()+
  ggtitle("Exp. de vida vs GDP, año 2015")+
  scale_color_manual(values = colores_desarrollo)

grid.arrange(z2000,z2005,z2010,z2015, ncol=2, nrow=2)


train =  datos_knn_2000[, -c(1,2)] # saco la columna con la etiqueta
test =  datos_knn_2000[, -c(1,2)]

labels_train = datos_knn_2000[,2] # guardo las etiquetas
clasif_datos <- knn(train = train, test = test, cl = labels_train, k = 3)
summary(clasif_datos)

labels_test = datos_knn_2000[,2]
confusionMatrix(as.factor(clasif_datos), as.factor(labels_test))



datos_knn_2000 <- datos_knn[is.element(datos_knn$ano,"2000"),]
datos_knn_2005 <- datos_knn[is.element(datos_knn$ano,"2005"),]
datos_knn_2010 <- datos_knn[is.element(datos_knn$ano,"2010"),]
datos_knn_2015 <- datos_knn[is.element(datos_knn$ano,"2015"),]


Nrep = 20
Ntest = 30
max_val = 15
valores = 1:max_val

resultados_crossval_train = matrix(NA, length(valores), 1)
resultados_crossval_test = matrix(NA, length(valores), 1)

datos_knn_2000 <- datos_knn_2000[,-1]

indices = sample(seq(1, nrow(datos_knn_2000)), 0.2*nrow(datos_knn_2000))
test = datos_knn_2000[indices, -1]
train = datos_knn_2000[-indices, -1]
test_labels = datos_knn_2000[indices, 1]
train_labels = datos_knn_2000[-indices, 1]

for(k in 1:max_val){
  clasificador_datos_k_train <- knn(train = train, test = train, cl = train_labels, k = k)
  clasificador_datos_k_test <- knn(train = train, test = test, cl = train_labels, k = k)
  
  exactitud_train = confusionMatrix(as.factor(clasificador_datos_k_train), as.factor(train_labels))$overall[[1]]
  exactitud_test = confusionMatrix(as.factor(clasificador_datos_k_test), as.factor(test_labels))$overall[[1]]
  
  resultados_crossval_train[k, 1] = exactitud_train
  resultados_crossval_test[k, 1] = exactitud_test
}


exact_train = rowMeans(resultados_crossval_train)
exact_test = rowMeans(resultados_crossval_test)

plot(valores, exact_train, col = 'darkblue', ylim=c(0.5,1), pch = 19, cex = 0.5, xlab = 'Valor de k', ylab = 'Exactitud', main = 'Exactitud en función del k')
lines(valores, exact_train, col = 'darkblue')
points(valores, exact_test, col = 'darkorange', pch = 19, cex = 0.5)
lines(valores, exact_test, col = 'darkorange')
legend('topright', legend = c('train', 'test'), col = c('darkblue', 'darkorange'), pch = 19)



```


```{r}
datos_knn_2000 <- datos_knn[is.element(datos_knn$ano,"2000"),]

table(datos_knn_2000$nivel)
developed <- datos_knn_2000[is.element(datos_knn_2000$nivel,"Developed"),]
developing_0 <- datos_knn_2000[is.element(datos_knn_2000$nivel,"Developing"),]
developing <- sample(seq(1, nrow(developing_0)), 0.5*nrow(developing_0))
niveles = rbind(developed,developing)
table(niveles$nivel)


Nrep = 20
Ntest = 30
max_val = 15
valores = 1:max_val

resultados_crossval_train = matrix(NA, length(valores), 1)
resultados_crossval_test = matrix(NA, length(valores), 1)

datos_knn_2000 <- datos_knn_2000[,-1]

indices = sample(seq(1, nrow(datos_knn_2000)), 0.2*nrow(datos_knn_2000))
test = datos_knn_2000[indices, -1]
train = datos_knn_2000[-indices, -1]
test_labels = datos_knn_2000[indices, 1]
train_labels = datos_knn_2000[-indices, 1]

for(k in 1:max_val){
  clasificador_datos_k_train <- knn(train = train, test = train, cl = train_labels, k = k)
  clasificador_datos_k_test <- knn(train = train, test = test, cl = train_labels, k = k)
  
  exactitud_train = confusionMatrix(as.factor(clasificador_datos_k_train), as.factor(train_labels))$overall[[1]]
  exactitud_test = confusionMatrix(as.factor(clasificador_datos_k_test), as.factor(test_labels))$overall[[1]]
  
  resultados_crossval_train[k, 1] = exactitud_train
  resultados_crossval_test[k, 1] = exactitud_test
}


exact_train = rowMeans(resultados_crossval_train)
exact_test = rowMeans(resultados_crossval_test)

plot(valores, exact_train, col = 'darkblue', ylim=c(0.5,1), pch = 19, cex = 0.5, xlab = 'Valor de k', ylab = 'Exactitud', main = 'Exactitud en función del k')
lines(valores, exact_train, col = 'darkblue')
points(valores, exact_test, col = 'darkorange', pch = 19, cex = 0.5)
lines(valores, exact_test, col = 'darkorange')
legend('topright', legend = c('train', 'test'), col = c('darkblue', 'darkorange'), pch = 19)
```


```{r}
# Knn con menos datos de developing --------------------------------------------

datos_knn_2000 <- datos_knn[is.element(datos_knn$ano,"2000"),]

table(datos_knn_2000$nivel)
developed <- datos_knn_2000[is.element(datos_knn_2000$nivel,"Developed"),]
developing_0 <- datos_knn_2000[is.element(datos_knn_2000$nivel,"Developing"),]
developing <- sample_n(developing_0, 63)
niveles = rbind(developed,developing)
table(niveles$nivel)


Nrep = 20
Ntest = 30
max_val = 15
valores = 1:max_val

resultados_crossval_train = matrix(NA, length(valores), 1)
resultados_crossval_test = matrix(NA, length(valores), 1)

datos_knn_2000 <- datos_knn_2000[,-1]

indices = sample(seq(1, nrow(datos_knn_2000)), 0.2*nrow(datos_knn_2000))
test = datos_knn_2000[indices, -1]
train = datos_knn_2000[-indices, -1]
test_labels = datos_knn_2000[indices, 1]
train_labels = datos_knn_2000[-indices, 1]

for(k in 1:max_val){
  clasificador_datos_k_train <- knn(train = train, test = train, cl = train_labels, k = k)
  clasificador_datos_k_test <- knn(train = train, test = test, cl = train_labels, k = k)
  
  exactitud_train = confusionMatrix(as.factor(clasificador_datos_k_train), as.factor(train_labels))$overall[[1]]
  exactitud_test = confusionMatrix(as.factor(clasificador_datos_k_test), as.factor(test_labels))$overall[[1]]
  
  resultados_crossval_train[k, 1] = exactitud_train
  resultados_crossval_test[k, 1] = exactitud_test
}


exact_train = rowMeans(resultados_crossval_train)
exact_test = rowMeans(resultados_crossval_test)

plot(valores, exact_train, col = 'darkblue', ylim=c(0.5,1), pch = 19, cex = 0.5, xlab = 'Valor de k', ylab = 'Exactitud', main = 'Exactitud en funcion del k')
lines(valores, exact_train, col = 'darkblue')
points(valores, exact_test, col = 'darkorange', pch = 19, cex = 0.5)
lines(valores, exact_test, col = 'darkorange')
legend('topright', legend = c('train', 'test'), col = c('darkblue', 'darkorange'), pch = 19)
```



